
     <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Field Buddy Pro v5.0 - Flow Edition</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0B1121">
  
  <!-- Libraries (lazy loaded) -->
  <script>
    // Lazy load heavy libs only when needed
    window.loadPDF = () => import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
    window.loadChart = () => import('https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js');
    window.loadSignature = () => import('https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js');
  </script>
  
  <style>
    /* ==================== DESIGN TOKENS ==================== */
    :root {
      /* Dark Theme */
      --bg-primary: #0B1121;
      --bg-secondary: #151B2D;
      --bg-tertiary: #1E2638;
      --bg-elevated: #242D42;
      --bg-card: #1A2332;
      
      /* Accents */
      --cyan: #00D9FF;
      --cyan-dark: #00A8CC;
      --orange: #FF6B35;
      --purple: #A855F7;
      --green: #10B981;
      --yellow: #FCD34D;
      --red: #EF4444;
      --blue: #3B82F6;
      
      /* Status Colors */
      --success: #10B981;
      --warning: #FCD34D;
      --danger: #EF4444;
      --info: #3B82F6;
      
      /* Text */
      --text-primary: #F8FAFC;
      --text-secondary: #CBD5E1;
      --text-tertiary: #94A3B8;
      --text-muted: #64748B;
      
      /* Glass Effects */
      --glass-bg: rgba(30, 38, 56, 0.8);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      
      /* Shadows */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 16px 32px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 24px 48px rgba(0, 0, 0, 0.6);
      
      /* Radius */
      --radius-sm: 6px;
      --radius: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 16px;
      --space-xl: 24px;
      --space-2xl: 32px;
      --space-3xl: 48px;
      
      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Touch Targets (Android GS24 optimized) */
      --touch-min: 48px;
      --touch-comfortable: 56px;
    }
    
    /* ==================== RESET & BASE ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html {
      font-size: 16px; /* Base for rem calculations */
      -webkit-text-size-adjust: 100%;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 0.875rem; /* 14px */
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      position: relative;
    }
    
    /* ==================== LAYOUT ==================== */
    .app {
      display: flex;
      min-height: 100vh;
      position: relative;
    }
    
    /* Sidebar - Collapsible on mobile */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--glass-border);
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
      transition: transform var(--transition-slow);
      transform: translateX(0);
    }
    
    .sidebar.collapsed {
      transform: translateX(-100%);
    }
    
    /* Main Content */
    .main {
      flex: 1;
      margin-left: 280px;
      min-height: 100vh;
      transition: margin-left var(--transition-slow);
    }
    
    .main.full-width {
      margin-left: 0;
    }
    
    /* Header */
    .header {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      padding: 0 var(--space-xl);
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: var(--space-lg);
    }
    
    .menu-toggle {
      display: none; /* Show on mobile */
      width: var(--touch-min);
      height: var(--touch-min);
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      transition: var(--transition);
    }
    
    .menu-toggle:active {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .page-title {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Workspace */
    .workspace {
      padding: var(--space-xl);
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ==================== SIDEBAR COMPONENTS ==================== */
    .sidebar-header {
      padding: var(--space-2xl);
      border-bottom: 1px solid var(--glass-border);
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
      animation: pulse-glow 3s ease-in-out infinite;
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 217, 255, 0.4); }
      50% { box-shadow: 0 0 30px rgba(0, 217, 255, 0.6); }
    }
    
    .logo-text h1 {
      font-size: 1.125rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.2;
    }
    
    .logo-text .version {
      font-size: 0.6875rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    /* Navigation */
    .nav {
      padding: var(--space-xl) 0;
    }
    
    .nav-section {
      margin-bottom: var(--space-xl);
    }
    
    .nav-section-title {
      padding: var(--space-sm) var(--space-xl);
      font-size: 0.6875rem;
      font-weight: 700;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md) var(--space-xl);
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-weight: 500;
      min-height: var(--touch-min);
      position: relative;
      user-select: none;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--cyan) 0%, transparent 100%);
      opacity: 0;
      transition: var(--transition);
    }
    
    .nav-item:hover {
      color: var(--cyan);
      background: rgba(0, 217, 255, 0.05);
    }
    
    .nav-item:hover::before {
      width: 100%;
      opacity: 0.1;
    }
    
    .nav-item.active {
      color: var(--cyan);
      background: rgba(0, 217, 255, 0.1);
      border-left-color: var(--cyan);
      font-weight: 600;
    }
    
    .nav-item .icon {
      font-size: 1.25rem;
      width: 28px;
      text-align: center;
      flex-shrink: 0;
    }
    
    /* ==================== CARDS ==================== */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--transition);
    }
    
    .card:hover {
      box-shadow: var(--shadow-md);
      border-color: rgba(0, 217, 255, 0.2);
    }
    
    .card-header {
      padding: var(--space-xl);
      border-bottom: 1px solid var(--glass-border);
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .card-body {
      padding: var(--space-xl);
    }
    
    .card-section {
      margin-bottom: var(--space-xl);
    }
    
    .card-section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--cyan);
      margin-bottom: var(--space-md);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .section-title::before {
      content: '';
      width: 4px;
      height: 16px;
      background: var(--cyan);
      border-radius: 2px;
    }
    
    /* ==================== FORM ELEMENTS ==================== */
    .form-grid {
      display: grid;
      gap: var(--space-lg);
    }
    
    .form-grid-2 {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
    
    .form-grid-3 {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: var(--space-sm);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }
    
    .required::after {
      content: '*';
      color: var(--red);
      margin-left: 2px;
    }
    
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: var(--cyan);
      color: var(--bg-primary);
      border-radius: 50%;
      font-size: 0.625rem;
      font-weight: 700;
      cursor: help;
      position: relative;
    }
    
    input,
    select,
    textarea {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      min-height: var(--touch-min);
      background: var(--bg-elevated);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-family: inherit;
      transition: var(--transition);
      outline: none;
    }
    
    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
      background: var(--bg-tertiary);
    }
    
    input[readonly] {
      background: var(--bg-secondary);
      color: var(--text-tertiary);
      cursor: not-allowed;
    }
    
    input.success {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.05);
    }
    
    input.warning {
      border-color: var(--warning);
      background: rgba(252, 211, 77, 0.05);
    }
    
    input.error {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
      line-height: 1.6;
    }
    
    /* ==================== BUTTONS ==================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-xl);
      min-height: var(--touch-min);
      background: var(--bg-elevated);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:active::before {
      width: 300px;
      height: 300px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
    }
    
    .btn-primary:hover:not(:disabled) {
      box-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
      transform: translateY(-2px);
    }
    
    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--green) 0%, #059669 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--red) 0%, #DC2626 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    .btn-secondary {
      background: var(--bg-elevated);
      border-color: var(--glass-border);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-tertiary);
      border-color: var(--cyan);
    }
    
    .btn-group {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }
    
    .btn-icon {
      min-width: var(--touch-min);
      padding: 0;
    }
    
    .btn-lg {
      min-height: var(--touch-comfortable);
      padding: var(--space-lg) var(--space-2xl);
      font-size: 1rem;
    }
    
    .btn-sm {
      min-height: 40px;
      padding: var(--space-sm) var(--space-lg);
      font-size: 0.8125rem;
    }
    
    /* ==================== QUICK ACTION CARDS ==================== */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-2xl);
    }
    
    .action-card {
      background: var(--bg-card);
      border: 2px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-2xl);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }
    
    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--cyan) 0%, var(--purple) 100%);
      opacity: 0;
      transition: var(--transition);
    }
    
    .action-card:hover {
      border-color: var(--cyan);
      transform: translateY(-4px);
      box-shadow: 0 0 30px rgba(0, 217, 255, 0.3);
    }
    
    .action-card:hover::before {
      opacity: 1;
    }
    
    .action-card:active {
      transform: translateY(-2px);
    }
    
    .action-icon {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin-bottom: var(--space-lg);
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
    }
    
    .action-card.orange .action-icon {
      background: linear-gradient(135deg, var(--orange) 0%, #E85D2F 100%);
      box-shadow: 0 0 20px rgba(255, 107, 53, 0.4);
    }
    
    .action-card.purple .action-icon {
      background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
    }
    
    .action-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: var(--space-sm);
      color: var(--text-primary);
    }
    
    .action-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.6;
      flex: 1;
    }
    
    .action-badge {
      display: inline-block;
      padding: 4px 12px;
      background: var(--cyan);
      color: white;
      border-radius: var(--radius-full);
      font-size: 0.625rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: var(--space-md);
      align-self: flex-start;
    }
    
    /* ==================== UTILITIES ==================== */
    .hidden {
      display: none !important;
    }
    
    .mt-sm { margin-top: var(--space-sm); }
    .mt-md { margin-top: var(--space-md); }
    .mt-lg { margin-top: var(--space-lg); }
    .mt-xl { margin-top: var(--space-xl); }
    
    .mb-sm { margin-bottom: var(--space-sm); }
    .mb-md { margin-bottom: var(--space-md); }
    .mb-lg { margin-bottom: var(--space-lg); }
    .mb-xl { margin-bottom: var(--space-xl); }
    
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    
    .text-success { color: var(--success); }
    .text-warning { color: var(--warning); }
    .text-danger { color: var(--danger); }
    .text-info { color: var(--info); }
    .text-muted { color: var(--text-muted); }
    
    /* ==================== TOAST NOTIFICATIONS ==================== */
    .toast {
      position: fixed;
      bottom: var(--space-2xl);
      right: var(--space-2xl);
      background: var(--bg-elevated);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg) var(--space-xl);
      box-shadow: var(--shadow-xl);
      z-index: 9999;
      min-width: 280px;
      max-width: 400px;
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
      pointer-events: none;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    
    .toast.success {
      background: linear-gradient(135deg, var(--cyan) 0%, var(--cyan-dark) 100%);
      color: white;
      border-color: transparent;
    }
    
    .toast.error {
      background: linear-gradient(135deg, var(--red) 0%, #DC2626 100%);
      color: white;
      border-color: transparent;
    }
    
    .toast.warning {
      background: linear-gradient(135deg, var(--orange) 0%, #E85D2F 100%);
      color: white;
      border-color: transparent;
    }
    
    /* ==================== LOADING STATES ==================== */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .skeleton {
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-elevated) 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s ease-in-out infinite;
      border-radius: var(--radius);
    }
    
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.open {
        transform: translateX(0);
        box-shadow: var(--shadow-xl);
      }
      
      .main {
        margin-left: 0;
      }
      
      .menu-toggle {
        display: flex;
      }
      
      .form-grid-2,
      .form-grid-3 {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 640px) {
      .workspace {
        padding: var(--space-lg);
      }
      
      .header {
        padding: 0 var(--space-lg);
        height: 56px;
      }
      
      .quick-actions {
        grid.quick-actions {
        grid-template-columns: 1fr;
      }
      
      .card-header {
        padding: var(--space-lg);
      }
      
      .card-body {
        padding: var(--space-lg);
      }
      
      .toast {
        bottom: var(--space-lg);
        right: var(--space-lg);
        left: var(--space-lg);
        min-width: auto;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    
    <!-- ==================== SIDEBAR ==================== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">üîß</div>
          <div class="logo-text">
            <h1>Field Buddy Pro</h1>
            <div class="version">v5.0 Flow Edition</div>
          </div>
        </div>
      </div>
      
      <nav class="nav">
        <div class="nav-section">
          <div class="nav-section-title">Quick Start</div>
          <button class="nav-item active" data-page="dashboard">
            <span class="icon">üè†</span>
            <span>Dashboard</span>
          </button>
          <button class="nav-item" data-page="new-job">
            <span class="icon">‚ûï</span>
            <span>New Service Call</span>
          </button>
          <button class="nav-item" data-page="continue">
            <span class="icon">‚ñ∂Ô∏è</span>
            <span>Continue Last Job</span>
          </button>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <button class="nav-item" data-page="measurements">
            <span class="icon">üìè</span>
            <span>Quick Measurements</span>
          </button>
          <button class="nav-item" data-page="materials">
            <span class="icon">üì¶</span>
            <span>Materials & Parts</span>
          </button>
          <button class="nav-item" data-page="photos">
            <span class="icon">üì∑</span>
            <span>Photo Gallery</span>
          </button>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">History</div>
          <button class="nav-item" data-page="history">
            <span class="icon">üìä</span>
            <span>Past Jobs</span>
          </button>
          <button class="nav-item" data-page="reports">
            <span class="icon">üìÑ</span>
            <span>Saved Reports</span>
          </button>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <button class="nav-item" data-page="sync">
            <span class="icon">üîÑ</span>
            <span>Sync Data</span>
          </button>
          <button class="nav-item" data-page="settings">
            <span class="icon">‚öôÔ∏è</span>
            <span>Preferences</span>
          </button>
        </div>
      </nav>
    </aside>
    
    <!-- ==================== MAIN CONTENT ==================== -->
    <main class="main" id="main">
      
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
            ‚ò∞
          </button>
          <h2 class="page-title" id="page-title">Dashboard</h2>
        </div>
        <div class="header-right">
          <button class="btn btn-icon" id="sync-status" aria-label="Sync status" title="All data saved locally">
            üíæ
          </button>
        </div>
      </header>
      
      <!-- Workspace -->
      <div class="workspace">
        
        <!-- ==================== DASHBOARD PAGE ==================== -->
        <div id="page-dashboard" class="page-content">
          <div class="mb-xl">
            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
              Welcome back, Mart√≠n! üëã
            </h1>
            <p style="color: var(--text-secondary); font-size: 1rem;">
              Let's get to work. What would you like to do?
            </p>
          </div>
          
          <div class="quick-actions">
            <div class="action-card" data-action="new-job">
              <div class="action-icon">‚ûï</div>
              <div class="action-title">Start New Job</div>
              <div class="action-description">
                Begin a fresh service call with guided workflow
              </div>
              <span class="action-badge">Quick Start</span>
            </div>
            
            <div class="action-card orange" data-action="continue">
              <div class="action-icon">‚ñ∂Ô∏è</div>
              <div class="action-title">Continue Last Job</div>
              <div class="action-description">
                Resume your most recent in-progress service call
              </div>
              <span class="action-badge" style="background: var(--orange);">Resume</span>
            </div>
            
            <div class="action-card purple" data-action="quick-measure">
              <div class="action-icon">üìè</div>
              <div class="action-title">Quick Measurements</div>
              <div class="action-description">
                Log temps & pressures without starting a full job
              </div>
              <span class="action-badge" style="background: var(--purple);">Fast Entry</span>
            </div>
          </div>
          
          <!-- Recent Jobs (INJECTION POINT 1) -->
          <div id="recent-jobs-container"></div>
          
          <!-- Quick Stats (INJECTION POINT 2) -->
          <div id="quick-stats-container"></div>
          
        </div>
        
        <!-- ==================== NEW JOB PAGE ==================== -->
        <div id="page-new-job" class="page-content hidden">
          
          <!-- Issue Type Selector (INJECTION POINT 3) -->
          <div id="issue-type-container"></div>
          
          <!-- Equipment Info (INJECTION POINT 4) -->
          <div id="equipment-info-container"></div>
          
          <!-- Dynamic Measurements (INJECTION POINT 5) -->
          <div id="measurements-container"></div>
          
          <!-- Smart Suggestions (INJECTION POINT 6) -->
          <div id="suggestions-container"></div>
          
          <!-- Photos & Notes (INJECTION POINT 7) -->
          <div id="photos-notes-container"></div>
          
          <!-- Action Buttons -->
          <div class="btn-group mt-xl">
            <button class="btn btn-secondary" id="save-draft">
              üíæ Save Draft
            </button>
            <button class="btn btn-success" id="complete-job">
              ‚úì Complete Job
            </button>
          </div>
          
        </div>
        
        <!-- ==================== CONTINUE JOB PAGE ==================== -->
        <div id="page-continue" class="page-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Resume Job</div>
            </div>
            <div class="card-body">
              <div id="continue-job-content">
                <p class="text-muted">No jobs in progress</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ==================== MEASUREMENTS PAGE ==================== -->
        <div id="page-measurements" class="page-content hidden">
          
          <!-- Quick Entry Form (INJECTION POINT 8) -->
          <div id="quick-measurements-form"></div>
          
        </div>
        
        <!-- ==================== MATERIALS PAGE ==================== -->
        <div id="page-materials" class="page-content hidden">
          
          <!-- Material Packages (INJECTION POINT 9) -->
          <div id="material-packages-container"></div>
          
          <!-- Custom Material Builder (INJECTION POINT 10) -->
          <div id="custom-materials-container"></div>
          
        </div>
        
        <!-- ==================== PHOTOS PAGE ==================== -->
        <div id="page-photos" class="page-content hidden">
          
          <!-- Photo Gallery (INJECTION POINT 11) -->
          <div id="photo-gallery-container"></div>
          
        </div>
        
        <!-- ==================== HISTORY PAGE ==================== -->
        <div id="page-history" class="page-content hidden">
          
          <!-- Job History List (INJECTION POINT 12) -->
          <div id="job-history-container"></div>
          
        </div>
        
        <!-- ==================== REPORTS PAGE ==================== -->
        <div id="page-reports" class="page-content hidden">
          
          <!-- Saved Reports (INJECTION POINT 13) -->
          <div id="saved-reports-container"></div>
          
        </div>
        
        <!-- ==================== SYNC PAGE ==================== -->
        <div id="page-sync" class="page-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Data Sync Status</div>
            </div>
            <div class="card-body">
              <div id="sync-status-content">
                <p class="text-success">‚úì All data saved locally</p>
                <p class="text-muted mt-md">Last saved: <span id="last-save-time">Never</span></p>
              </div>
              <div class="btn-group mt-lg">
                <button class="btn btn-primary" id="export-data">
                  üì§ Export All Data
                </button>
                <button class="btn btn-secondary" id="import-data">
                  üì• Import Data
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ==================== SETTINGS PAGE ==================== -->
        <div id="page-settings" class="page-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Preferences</div>
            </div>
            <div class="card-body">
              
              <div class="card-section">
                <div class="section-title">Technician Info</div>
                <div class="form-grid form-grid-2">
                  <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="tech-name" value="Mart√≠n Perez">
                  </div>
                  <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="tech-phone" value="(346)451-0024">
                  </div>
                </div>
                <div class="form-group mt-md">
                  <label>Email</label>
                  <input type="email" id="tech-email" value="Mperez@villageplumbing.com">
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Default Values</div>
                <div class="form-grid form-grid-2">
                  <div class="form-group">
                    <label>Default Refrigerant</label>
                    <select id="default-refrigerant">
                      <option value="R-410A" selected>R-410A</option>
                      <option value="R-22">R-22</option>
                      <option value="R-32">R-32</option>
                      <option value="R-454B">R-454B</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Measurement Units</label>
                    <select id="default-units">
                      <option value="imperial" selected>Imperial (¬∞F, PSI)</option>
                      <option value="metric">Metric (¬∞C, kPa)</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div class="btn-group mt-xl">
                <button class="btn btn-success" id="save-settings">
                  ‚úì Save Preferences
                </button>
                <button class="btn btn-danger" id="clear-all-data">
                  üóëÔ∏è Clear All Data
                </button>
              </div>
              
            </div>
          </div>
        </div>
        
      </div>
      
    </main>
    
  </div>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast" role="alert" aria-live="polite"></div>
  
  <script>
    // ==================== [INJECTION POINT A: STATE MANAGEMENT] ====================
    // ==================== STATE MANAGEMENT ====================

// Global application state
const AppState = {
  // Current user/technician
  tech: {
    name: 'Mart√≠n Perez',
    phone: '(346)451-0024',
    email: 'Mperez@villageplumbing.com'
  },
  
  // Current active job
  currentJob: null,
  
  // All jobs stored locally
  jobs: [],
  
  // App preferences
  settings: {
    defaultRefrigerant: 'R-410A',
    units: 'imperial',
    autoSave: true,
    photoQuality: 'high'
  },
  
  // UI state
  ui: {
    currentPage: 'dashboard',
    sidebarOpen: false,
    unsavedChanges: false
  }
};

// Job template structure
const createNewJob = () => ({
  id: generateUUID(),
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
  status: 'in_progress', // in_progress, completed, draft
  
  // Customer info
  customer: {
    name: '',
    address: '',
    phone: ''
  },
  
  // Issue/complaint
  issue: {
    type: '', // no_cool, no_heat, poor_performance, noise, maintenance
    description: '',
    reportedBy: 'customer'
  },
  
  // Equipment details
  equipment: {
    type: '', // split_system, package_unit, heat_pump, furnace, mini_split
    indoor: {
      brand: '',
      model: '',
      serial: ''
    },
    outdoor: {
      brand: '',
      model: '',
      serial: ''
    },
    tonnage: '',
    refrigerant: 'R-410A',
    filterSize: '',
    ageYears: null
  },
  
  // Measurements timeline (chronological)
  measurements: [],
  
  // Photos
  photos: [],
  
  // Voice notes
  notes: [],
  
  // Materials/parts used
  materials: [],
  
  // Smart suggestions from diagnostic engine
  suggestions: [],
  
  // Final diagnosis & work performed
  diagnosis: {
    issue: '',
    cause: '',
    workPerformed: '',
    recommendations: ''
  },
  
  // Customer signature
  signature: null,
  
  // Quality score
  qualityScore: 0
});

// Add measurement to current job
const addMeasurement = (type, value, unit, label) => {
  if (!AppState.currentJob) return;
  
  const measurement = {
    id: generateUUID(),
    timestamp: new Date().toISOString(),
    type, // temp, pressure, voltage, amperage
    field: label,
    value: parseFloat(value),
    unit,
    valid: true
  };
  
  AppState.currentJob.measurements.push(measurement);
  AppState.currentJob.updatedAt = new Date().toISOString();
  AppState.ui.unsavedChanges = true;
  
  // Auto-save if enabled
  if (AppState.settings.autoSave) {
    saveToStorage();
  }
  
  return measurement;
};

// Add photo to current job
const addPhoto = (dataUrl, category = 'general') => {
  if (!AppState.currentJob) return;
  
  const photo = {
    id: generateUUID(),
    timestamp: new Date().toISOString(),
    data: dataUrl,
    category, // equipment, issue, repair, before, after
    caption: ''
  };
  
  AppState.currentJob.photos.push(photo);
  AppState.currentJob.updatedAt = new Date().toISOString();
  AppState.ui.unsavedChanges = true;
  
  if (AppState.settings.autoSave) {
    saveToStorage();
  }
  
  return photo;
};

// Update job status
const updateJobStatus = (status) => {
  if (!AppState.currentJob) return;
  
  AppState.currentJob.status = status;
  AppState.currentJob.updatedAt = new Date().toISOString();
  
  if (status === 'completed') {
    AppState.currentJob.completedAt = new Date().toISOString();
    calculateQualityScore();
  }
  
  saveToStorage();
};

// Calculate quality score based on completeness
const calculateQualityScore = () => {
  if (!AppState.currentJob) return 0;
  
  let score = 0;
  const job = AppState.currentJob;
  
  // Customer info (20 points)
  if (job.customer.name) score += 7;
  if (job.customer.address) score += 7;
  if (job.customer.phone) score += 6;
  
  // Equipment info (15 points)
  if (job.equipment.type) score += 5;
  if (job.equipment.indoor.brand) score += 5;
  if (job.equipment.indoor.model) score += 5;
  
  // Measurements (25 points)
  if (job.measurements.length >= 3) score += 10;
  if (job.measurements.length >= 6) score += 10;
  if (job.measurements.length >= 10) score += 5;
  
  // Photos (15 points)
  if (job.photos.length >= 1) score += 5;
  if (job.photos.length >= 3) score += 5;
  if (job.photos.length >= 5) score += 5;
  
  // Diagnosis (15 points)
  if (job.diagnosis.issue) score += 5;
  if (job.diagnosis.cause) score += 5;
  if (job.diagnosis.workPerformed) score += 5;
  
  // Signature (10 points)
  if (job.signature) score += 10;
  
  job.qualityScore = Math.min(score, 100);
  return job.qualityScore;
};

// Get most recent measurement by type
const getLastMeasurement = (type) => {
  if (!AppState.currentJob) return null;
  
  const measurements = AppState.currentJob.measurements
    .filter(m => m.type === type)
    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  
  return measurements[0] || null;
};

// Get all measurements of specific type
const getMeasurementsByType = (type) => {
  if (!AppState.currentJob) return [];
  
  return AppState.currentJob.measurements
    .filter(m => m.type === type)
    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
};
    
    
    // ==================== [INJECTION POINT B: UTILITY FUNCTIONS] ====================// ==================== UTILITY FUNCTIONS ====================

// Generate UUID v4
const generateUUID = () => {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
};

// Format date/time
const formatDateTime = (isoString) => {
  const date = new Date(isoString);
  return date.toLocaleString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
};

// Format date only
const formatDate = (isoString) => {
  const date = new Date(isoString);
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
};

// Show toast notification
const showToast = (message, type = 'success') => {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = `toast show ${type}`;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
};

// Get element by ID (shorthand)
const $ = (id) => document.getElementById(id);

// Query selector (shorthand)
const $$ = (selector) => document.querySelectorAll(selector);

// Debounce function (for auto-save)
const debounce = (func, wait) => {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
};

// Validate number input
const isValidNumber = (value) => {
  return !isNaN(parseFloat(value)) && isFinite(value);
};

// Clamp number between min and max
const clamp = (num, min, max) => {
  return Math.min(Math.max(num, min), max);
};

// Format temperature
const formatTemp = (value, unit = 'F') => {
  if (!isValidNumber(value)) return 'N/A';
  return `${parseFloat(value).toFixed(1)}¬∞${unit}`;
};

// Format pressure
const formatPressure = (value, unit = 'PSI') => {
  if (!isValidNumber(value)) return 'N/A';
  return `${parseFloat(value).toFixed(1)} ${unit}`;
};

// Format voltage
const formatVoltage = (value) => {
  if (!isValidNumber(value)) return 'N/A';
  return `${parseFloat(value).toFixed(1)}V`;
};

// Format amperage
const formatAmperage = (value) => {
  if (!isValidNumber(value)) return 'N/A';
  return `${parseFloat(value).toFixed(1)}A`;
};

// Get relative time (e.g., "2 hours ago")
const getRelativeTime = (isoString) => {
  const date = new Date(isoString);
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);
  
  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins} min ago`;
  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
  if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
  return formatDate(isoString);
};

// Compress image (for photo storage)
const compressImage = (dataUrl, maxWidth = 1200, quality = 0.8) => {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      let width = img.width;
      let height = img.height;
      
      if (width > maxWidth) {
        height = (height * maxWidth) / width;
        width = maxWidth;
      }
      
      canvas.width = width;
      canvas.height = height;
      
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);
      
      resolve(canvas.toDataURL('image/jpeg', quality));
    };
    img.src = dataUrl;
  });
};

// Export data as JSON file
const exportJSON = (data, filename) => {
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
};

// Copy text to clipboard
const copyToClipboard = (text) => {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      showToast('Copied to clipboard!');
    }).catch(() => {
      showToast('Failed to copy', 'error');
    });
  } else {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showToast('Copied to clipboard!');
  }
};
    
    
    
    // ==================== [INJECTION POINT C: NAVIGATION SYSTEM] ====================
    // ==================== NAVIGATION SYSTEM ====================

// Switch between pages
const switchPage = (pageName) => {
  // Hide all pages
  $$('.page-content').forEach(page => {
    page.classList.add('hidden');
  });
  
  // Show selected page
  const targetPage = $(`page-${pageName}`);
  if (targetPage) {
    targetPage.classList.remove('hidden');
  }
  
  // Update navigation active state
  $$('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  
  const activeNavItem = document.querySelector(`.nav-item[data-page="${pageName}"]`);
  if (activeNavItem) {
    activeNavItem.classList.add('active');
  }
  
  // Update page title
  const titleMap = {
    'dashboard': 'Dashboard',
    'new-job': 'New Service Call',
    'continue': 'Continue Job',
    'measurements': 'Quick Measurements',
    'materials': 'Materials & Parts',
    'photos': 'Photo Gallery',
    'history': 'Job History',
    'reports': 'Saved Reports',
    'sync': 'Data Sync',
    'settings': 'Settings'
  };
  
  const pageTitle = $(titleMap[pageName]);
  if (pageTitle) {
    pageTitle.textContent = titleMap[pageName];
  }
  
  // Update state
  AppState.ui.currentPage = pageName;
  
  // Close mobile menu if open
  closeMobileMenu();
  
  // Page-specific actions
  onPageLoad(pageName);
};

// Handle page-specific load actions
const onPageLoad = (pageName) => {
  switch(pageName) {
    case 'dashboard':
      renderRecentJobs();
      renderQuickStats();
      break;
    case 'new-job':
      if (!AppState.currentJob) {
        AppState.currentJob = createNewJob();
      }
      renderIssueTypeSelector();
      break;
    case 'continue':
      renderContinueJob();
      break;
    case 'measurements':
      renderQuickMeasurementsForm();
      break;
    case 'materials':
      renderMaterialPackages();
      break;
    case 'photos':
      renderPhotoGallery();
      break;
    case 'history':
      renderJobHistory();
      break;
    case 'reports':
      renderSavedReports();
      break;
  }
};

// Toggle mobile menu
const toggleMobileMenu = () => {
  const sidebar = $('sidebar');
  const main = $('main');
  
  if (sidebar.classList.contains('open')) {
    closeMobileMenu();
  } else {
    openMobileMenu();
  }
};

// Open mobile menu
const openMobileMenu = () => {
  const sidebar = $('sidebar');
  const main = $('main');
  
  sidebar.classList.remove('collapsed');
  sidebar.classList.add('open');
  main.classList.add('full-width');
  AppState.ui.sidebarOpen = true;
};

// Close mobile menu
const closeMobileMenu = () => {
  const sidebar = $('sidebar');
  const main = $('main');
  
  if (window.innerWidth <= 1024) {
    sidebar.classList.add('collapsed');
    sidebar.classList.remove('open');
  }
  
  AppState.ui.sidebarOpen = false;
};

// Handle browser back/forward
window.addEventListener('popstate', (e) => {
  const page = e.state?.page || 'dashboard';
  switchPage(page);
});

// Quick action handlers
const handleQuickAction = (action) => {
  switch(action) {
    case 'new-job':
      AppState.currentJob = createNewJob();
      switchPage('new-job');
      showToast('New job started');
      break;
      
    case 'continue':
      const lastJob = AppState.jobs
        .filter(j => j.status === 'in_progress')
        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))[0];
      
      if (lastJob) {
        AppState.currentJob = lastJob;
        switchPage('new-job');
        showToast('Resuming job');
      } else {
        switchPage('continue');
        showToast('No jobs in progress', 'warning');
      }
      break;
      
    case 'quick-measure':
      switchPage('measurements');
      break;
  }
};
    
    
    // ==================== [INJECTION POINT D: OFFLINE STORAGE] ====================
    // ==================== OFFLINE STORAGE (IndexedDB) ====================

// IndexedDB database name and version
const DB_NAME = 'FieldBuddyPro';
const DB_VERSION = 1;
let db = null;

// Initialize IndexedDB
const initDB = () => {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    
    request.onerror = () => {
      console.error('IndexedDB error:', request.error);
      reject(request.error);
    };
    
    request.onsuccess = () => {
      db = request.result;
      console.log('IndexedDB initialized');
      resolve(db);
    };
    
    request.onupgradeneeded = (event) => {
      db = event.target.result;
      
      // Create object stores
      if (!db.objectStoreNames.contains('jobs')) {
        const jobsStore = db.createObjectStore('jobs', { keyPath: 'id' });
        jobsStore.createIndex('status', 'status', { unique: false });
        jobsStore.createIndex('createdAt', 'createdAt', { unique: false });
        jobsStore.createIndex('updatedAt', 'updatedAt', { unique: false });
      }
      
      if (!db.objectStoreNames.contains('settings')) {
        db.createObjectStore('settings', { keyPath: 'key' });
      }
      
      if (!db.objectStoreNames.contains('photos')) {
        const photosStore = db.createObjectStore('photos', { keyPath: 'id' });
        photosStore.createIndex('jobId', 'jobId', { unique: false });
      }
      
      console.log('IndexedDB schema created');
    };
  });
};

// Save current state to IndexedDB
const saveToStorage = debounce(() => {
  if (!db) {
    console.warn('Database not initialized');
    return;
  }
  
  const transaction = db.transaction(['jobs', 'settings'], 'readwrite');
  
  // Save current job if exists
  if (AppState.currentJob) {
    const jobsStore = transaction.objectStore('jobs');
    
    // Check if job already exists
    const existingJobIndex = AppState.jobs.findIndex(j => j.id === AppState.currentJob.id);
    
    if (existingJobIndex >= 0) {
      AppState.jobs[existingJobIndex] = AppState.currentJob;
    } else {
      AppState.jobs.push(AppState.currentJob);
    }
    
    jobsStore.put(AppState.currentJob);
  }
  
  // Save settings
  const settingsStore = transaction.objectStore('settings');
  settingsStore.put({ key: 'appSettings', value: AppState.settings });
  settingsStore.put({ key: 'techInfo', value: AppState.tech });
  
  transaction.oncomplete = () => {
    AppState.ui.unsavedChanges = false;
    updateSyncStatus();
    console.log('Data saved to IndexedDB');
  };
  
  transaction.onerror = () => {
    console.error('Save failed:', transaction.error);
    showToast('Failed to save data', 'error');
  };
}, 500); // Debounce 500ms

// Load all data from IndexedDB
const loadFromStorage = async () => {
  if (!db) {
    await initDB();
  }
  
  return new Promise((resolve, reject) => {
    const transaction = db.transaction(['jobs', 'settings'], 'readonly');
    
    // Load jobs
    const jobsStore = transaction.objectStore('jobs');
    const jobsRequest = jobsStore.getAll();
    
    jobsRequest.onsuccess = () => {
      AppState.jobs = jobsRequest.result || [];
      console.log(`Loaded ${AppState.jobs.length} jobs`);
    };
    
    // Load settings
    const settingsStore = transaction.objectStore('settings');
    
    const settingsRequest = settingsStore.get('appSettings');
    settingsRequest.onsuccess = () => {
      if (settingsRequest.result) {
        AppState.settings = { ...AppState.settings, ...settingsRequest.result.value };
      }
    };
    
    const techRequest = settingsStore.get('techInfo');
    techRequest.onsuccess = () => {
      if (techRequest.result) {
        AppState.tech = { ...AppState.tech, ...techRequest.result.value };
      }
    };
    
    transaction.oncomplete = () => {
      console.log('Data loaded from IndexedDB');
      resolve();
    };
    
    transaction.onerror = () => {
      console.error('Load failed:', transaction.error);
      reject(transaction.error);
    };
  });
};

// Delete a job
const deleteJob = (jobId) => {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction(['jobs'], 'readwrite');
    const jobsStore = transaction.objectStore('jobs');
    const request = jobsStore.delete(jobId);
    
    request.onsuccess = () => {
      AppState.jobs = AppState.jobs.filter(j => j.id !== jobId);
      
      if (AppState.currentJob?.id === jobId) {
        AppState.currentJob = null;
      }
      
      showToast('Job deleted');
      resolve();
    };
    
    request.onerror = () => {
      showToast('Failed to delete job', 'error');
      reject(request.error);
    };
  });
};

// Export all data as JSON
const exportAllData = () => {
  const exportData = {
    version: '5.0',
    exportedAt: new Date().toISOString(),
    tech: AppState.tech,
    jobs: AppState.jobs,
    settings: AppState.settings
  };
  
  const filename = `field-buddy-backup-${new Date().toISOString().split('T')[0]}.json`;
  exportJSON(exportData, filename);
  showToast('Data exported successfully');
};

// Import data from JSON
const importData = (file) => {
  const reader = new FileReader();
  
  reader.onload = async (e) => {
    try {
      const importedData = JSON.parse(e.target.result);
      
      // Validate data structure
      if (!importedData.jobs || !Array.isArray(importedData.jobs)) {
        throw new Error('Invalid data format');
      }
      
      // Merge imported jobs
      importedData.jobs.forEach(importedJob => {
        const existingIndex = AppState.jobs.findIndex(j => j.id === importedJob.id);
        
        if (existingIndex >= 0) {
          // Update existing job if imported version is newer
          if (new Date(importedJob.updatedAt) > new Date(AppState.jobs[existingIndex].updatedAt)) {
            AppState.jobs[existingIndex] = importedJob;
          }
        } else {
          // Add new job
          AppState.jobs.push(importedJob);
        }
      });
      
      // Update settings if provided
      if (importedData.settings) {
        AppState.settings = { ...AppState.settings, ...importedData.settings };
      }
      
      // Update tech info if provided
      if (importedData.tech) {
        AppState.tech = { ...AppState.tech, ...importedData.tech };
      }
      
      // Save to IndexedDB
      await saveAllJobs();
      
      showToast(`Imported ${importedData.jobs.length} jobs`);
      renderJobHistory();
      
    } catch (error) {
      console.error('Import error:', error);
      showToast('Failed to import data', 'error');
    }
  };
  
  reader.readAsText(file);
};

// Save all jobs to IndexedDB (for import)
const saveAllJobs = () => {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction(['jobs', 'settings'], 'readwrite');
    const jobsStore = transaction.objectStore('jobs');
    const settingsStore = transaction.objectStore('settings');
    
    // Clear existing jobs
    jobsStore.clear();
    
    // Add all jobs
    AppState.jobs.forEach(job => {
      jobsStore.add(job);
    });
    
    // Save settings
    settingsStore.put({ key: 'appSettings', value: AppState.settings });
    settingsStore.put({ key: 'techInfo', value: AppState.tech });
    
    transaction.oncomplete = () => {
      console.log('All jobs saved');
      resolve();
    };
    
    transaction.onerror = () => {
      console.error('Save all failed:', transaction.error);
      reject(transaction.error);
    };
  });
};

// Update sync status indicator
const updateSyncStatus = () => {
  const syncBtn = $('sync-status');
  const lastSaveTime = $('last-save-time');
  
  if (syncBtn) {
    if (AppState.ui.unsavedChanges) {
      syncBtn.textContent = '‚è≥';
      syncBtn.title = 'Saving...';
    } else {
      syncBtn.textContent = '‚úì';
      syncBtn.title = 'All data saved';
    }
  }
  
  if (lastSaveTime) {
    lastSaveTime.textContent = formatDateTime(new Date().toISOString());
  }
};

// Clear all data (with confirmation)
const clearAllData = async () => {
  const confirmed = confirm('‚ö†Ô∏è This will delete ALL jobs and data. Are you sure?');
  
  if (!confirmed) return;
  
  const doubleConfirm = confirm('This cannot be undone. Really delete everything?');
  
  if (!doubleConfirm) return;
  
  try {
    const transaction = db.transaction(['jobs', 'settings', 'photos'], 'readwrite');
    
    transaction.objectStore('jobs').clear();
    transaction.objectStore('settings').clear();
    transaction.objectStore('photos').clear();
    
    transaction.oncomplete = () => {
      AppState.jobs = [];
      AppState.currentJob = null;
      showToast('All data cleared');
      switchPage('dashboard');
    };
    
    transaction.onerror = () => {
      showToast('Failed to clear data', 'error');
    };
  } catch (error) {
    console.error('Clear data error:', error);
    showToast('Failed to clear data', 'error');
  }
};
```

---

# **SECTION E: ISSUE TYPE SELECTOR**

**PASTE THIS INTO `[INJECTION POINT E: ISSUE TYPE SELECTOR]`**

```javascript
// ==================== ISSUE TYPE SELECTOR ====================

// Issue types with smart follow-up questions
const issueTypes = [
  {
    id: 'no_cool',
    icon: 'üî•',
    label: 'No Cooling',
    description: 'System running but not cooling',
    gradient: 'linear-gradient(135deg, #EF4444 0%, #DC2626 100%)',
    questions: ['Is the outdoor unit running?', 'Is air blowing from vents?', 'Any unusual sounds?']
  },
  {
    id: 'no_heat',
    icon: '‚ùÑÔ∏è',
    label: 'No Heating',
    description: 'System running but not heating',
    gradient: 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)',
    questions: ['Is furnace igniting?', 'Any error codes?', 'Blower running?']
  },
  {
    id: 'poor_performance',
    icon: 'üìâ',
    label: 'Poor Performance',
    description: 'System works but not well',
    gradient: 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)',
    questions: ['Which rooms affected?', 'Recent changes?', 'Filter condition?']
  },
  {
    id: 'noise',
    icon: 'üîä',
    label: 'Strange Noises',
    description: 'Unusual sounds from system',
    gradient: 'linear-gradient(135deg, #A855F7 0%, #7C3AED 100%)',
    questions: ['What type of sound?', 'When does it occur?', 'Indoor or outdoor unit?']
  },
  {
    id: 'leak',
    icon: 'üíß',
    label: 'Water Leak',
    description: 'Water leaking from unit',
    gradient: 'linear-gradient(135deg, #06B6D4 0%, #0891B2 100%)',
    questions: ['Where is leak?', 'How much water?', 'Constant or intermittent?']
  },
  {
    id: 'maintenance',
    icon: 'üîß',
    label: 'Scheduled Maintenance',
    description: 'Routine service call',
    gradient: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
    questions: ['Last service date?', 'Any concerns?', 'Seasonal prep?']
  }
];

// Render issue type selector
const renderIssueTypeSelector = () => {
  const container = $('issue-type-container');
  if (!container) return;
  
  const selectedIssue = AppState.currentJob?.issue.type;
  
  let html = `
    <div class="card">
      <div class="card-header">
        <div class="card-title">What's the issue?</div>
      </div>
      <div class="card-body">
        <div class="quick-actions">
  `;
  
  issueTypes.forEach(issue => {
    const isSelected = selectedIssue === issue.id ? 'selected' : '';
    
    html += `
      <div class="action-card ${isSelected}" 
           data-issue="${issue.id}"
           onclick="selectIssueType('${issue.id}')"
           style="border-color: ${isSelected ? 'var(--cyan)' : 'var(--glass-border)'};">
        <div class="action-icon" style="background: ${issue.gradient};">${issue.icon}</div>
        <div class="action-title">${issue.label}</div>
        <div class="action-description">${issue.description}</div>
      </div>
    `;
  });
  
  html += `
        </div>
      </div>
    </div>
  `;
  
  // Show follow-up questions if issue selected
  if (selectedIssue) {
    const issue = issueTypes.find(i => i.id === selectedIssue);
    
    html += `
      <div class="card">
        <div class="card-header">
          <div class="card-title">Tell me more...</div>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label>Customer Description</label>
            <textarea 
              id="issue-description" 
              placeholder="What did the customer report?"
              oninput="updateIssueDescription(this.value)"
              rows="3"
            >${AppState.currentJob?.issue.description || ''}</textarea>
          </div>
          
          <div class="section-title mt-lg">Quick Questions</div>
          ${issue.questions.map((q, i) => `
            <div class="form-group">
              <label>${q}</label>
              <input 
                type="text" 
                id="issue-q-${i}"
                placeholder="Answer..."
              >
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  container.innerHTML = html;
};

// Select issue type
const selectIssueType = (issueId) => {
  if (!AppState.currentJob) return;
  
  AppState.currentJob.issue.type = issueId;
  AppState.currentJob.updatedAt = new Date().toISOString();
  
  // Re-render to show follow-up questions
  renderIssueTypeSelector();
  
  // Show equipment selector
  renderEquipmentSelector();
  
  // Auto-save
  saveToStorage();
  
  showToast('Issue type selected');
};

// Update issue description
const updateIssueDescription = (description) => {
  if (!AppState.currentJob) return;
  
  AppState.currentJob.issue.description = description;
  AppState.currentJob.updatedAt = new Date().toISOString();
  AppState.ui.unsavedChanges = true;
  
  saveToStorage();
};
    
    
    // ==================== [INJECTION POINT E: ISSUE TYPE SELECTOR] ====================
    // ==================== EQUIPMENT DATABASE & SELECTOR ====================

// Equipment types with common brands and models
const equipmentDatabase = {
  split_system: {
    label: 'Split System',
    icon: 'üè†',
    description: 'Separate indoor/outdoor units',
    brands: ['Carrier', 'Trane', 'Lennox', 'Rheem', 'Goodman', 'York', 'Bryant', 'American Standard', 'Daikin', 'Mitsubishi'],
    commonModels: {
      'Carrier': ['24ACC3', '24APB6', '24VNA0', 'FE4A', 'FB4C'],
      'Trane': ['4TTR3', '4TWR3', '4TTR6', 'TEM4', 'TAM7'],
      'Lennox': ['13ACX', 'EL16XC1', 'XC25', 'CBX27UH', 'CBA38MV'],
      'Rheem': ['RA14', 'RA16', 'RA20', 'RH1T', 'RH2T'],
      'Goodman': ['GSX13', 'GSX14', 'GSX16', 'ARUF', 'AVPTC']
    },
    specs: {
      refrigerant: ['R-410A', 'R-22', 'R-454B', 'R-32'],
      tonnage: ['1.5', '2', '2.5', '3', '3.5', '4', '5'],
      seer: ['13', '14', '15', '16', '17', '18', '19', '20', '21', '22']
    }
  },
  
  package_unit: {
    label: 'Package Unit',
    icon: 'üì¶',
    description: 'All-in-one rooftop or ground unit',
    brands: ['Carrier', 'Trane', 'Lennox', 'Rheem', 'Goodman', 'York'],
    commonModels: {
      'Carrier': ['50ZPA', '50ZPB', '48TCED'],
      'Trane': ['4WCC3', '4YCC3', '4WHZ3'],
      'Lennox': ['LRP14', 'LRP16', 'LGH'],
      'Rheem': ['RQNL', 'RQPM', 'RQRM'],
      'Goodman': ['GPG13', 'GPG14', 'GPC14']
    },
    specs: {
      refrigerant: ['R-410A', 'R-22'],
      tonnage: ['2', '3', '4', '5', '7.5', '10'],
      seer: ['13', '14', '15', '16']
    }
  },
  
  heat_pump: {
    label: 'Heat Pump',
    icon: 'üîÑ',
    description: 'Heating and cooling in one',
    brands: ['Carrier', 'Trane', 'Lennox', 'Rheem', 'Goodman', 'York', 'Mitsubishi', 'Daikin'],
    commonModels: {
      'Carrier': ['25VNA8', '25HCB6', '25HNB6'],
      'Trane': ['4TWZ8', '4TWV8', '4WCZ8'],
      'Lennox': ['XP25', 'XP21', 'HP26'],
      'Rheem': ['RP16', 'RP17', 'RP20'],
      'Goodman': ['GSZC18', 'DSXC18', 'GSZ14']
    },
    specs: {
      refrigerant: ['R-410A', 'R-454B'],
      tonnage: ['2', '2.5', '3', '3.5', '4', '5'],
      seer: ['14', '15', '16', '17', '18', '19', '20', '21', '22'],
      hspf: ['8', '8.5', '9', '9.5', '10', '10.5', '11', '12', '13']
    }
  },
  
  furnace: {
    label: 'Gas Furnace',
    icon: 'üî•',
    description: 'Gas or electric heating',
    brands: ['Carrier', 'Trane', 'Lennox', 'Rheem', 'Goodman', 'York', 'American Standard'],
    commonModels: {
      'Carrier': ['59SP5', '59TP6', '59MN7'],
      'Trane': ['S9V2', 'S9X2', 'XV95'],
      'Lennox': ['SLP98V', 'EL296V', 'ML296V'],
      'Rheem': ['R96V', 'R97V', 'R98V'],
      'Goodman': ['GMVC96', 'GCVC96', 'GMSS96']
    },
    specs: {
      btu: ['40K', '60K', '80K', '100K', '120K'],
      afue: ['80', '92', '93', '95', '96', '97', '98'],
      stages: ['Single', 'Two-Stage', 'Modulating']
    }
  },
  
  mini_split: {
    label: 'Mini-Split',
    icon: '‚ùÑÔ∏è',
    description: 'Ductless wall-mounted units',
    brands: ['Mitsubishi', 'Daikin', 'Fujitsu', 'LG', 'Samsung', 'Carrier', 'Trane'],
    commonModels: {
      'Mitsubishi': ['MSZ-FH', 'MSZ-GL', 'MUZ-FH'],
      'Daikin': ['FTXS', 'FTXM', 'RXS'],
      'Fujitsu': ['ASU9RLF1', 'ASU12RLF1', 'AOU9RLF1'],
      'LG': ['LSN090HXV', 'LSN120HXV', 'LSU120HXV'],
      'Samsung': ['AR09TXHZAWK', 'AR12TXHZAWK']
    },
    specs: {
      refrigerant: ['R-410A', 'R-32'],
      btu: ['9K', '12K', '18K', '24K', '30K', '36K'],
      seer: ['16', '18', '20', '22', '24', '26', '30']
    }
  }
};

// Render equipment selector
const renderEquipmentSelector = () => {
  const container = $('equipment-info-container');
  if (!container) return;
  
  const selectedType = AppState.currentJob?.equipment.type;
  
  let html = `
    <div class="card">
      <div class="card-header">
        <div class="card-title">Equipment Type</div>
      </div>
      <div class="card-body">
        <div class="quick-actions">
  `;
  
  // Equipment type cards
  Object.keys(equipmentDatabase).forEach(typeKey => {
    const type = equipmentDatabase[typeKey];
    const isSelected = selectedType === typeKey;
    
    html += `
      <div class="action-card ${isSelected ? 'selected' : ''}" 
           onclick="selectEquipmentType('${typeKey}')"
           style="min-height: 150px;">
        <div class="action-icon">${type.icon}</div>
        <div class="action-title">${type.label}</div>
        <div class="action-description">${type.description}</div>
      </div>
    `;
  });
  
  html += `
        </div>
      </div>
    </div>
  `;
  
  // Show equipment details form if type selected
  if (selectedType) {
    const equipment = equipmentDatabase[selectedType];
    const job = AppState.currentJob;
    
    html += `
      <div class="card">
        <div class="card-header">
          <div class="card-title">Equipment Details</div>
        </div>
        <div class="card-body">
          
          <!-- Indoor Unit -->
          ${selectedType !== 'package_unit' ? `
          <div class="card-section">
            <div class="section-title">Indoor Unit</div>
            <div class="form-grid form-grid-2">
              <div class="form-group">
                <label>Brand</label>
                <select id="indoor-brand" onchange="updateEquipmentField('indoor', 'brand', this.value); populateModels('indoor')">
                  <option value="">Select brand...</option>
                  ${equipment.brands.map(brand => `
                    <option value="${brand}" ${job.equipment.indoor.brand === brand ? 'selected' : ''}>
                      ${brand}
                    </option>
                  `).join('')}
                </select>
              </div>
              
              <div class="form-group">
                <label>Model Number</label>
                <input 
                  type="text" 
                  id="indoor-model" 
                  list="indoor-models"
                  value="${job.equipment.indoor.model || ''}"
                  onchange="updateEquipmentField('indoor', 'model', this.value)"
                  placeholder="e.g., FE4A">
                <datalist id="indoor-models"></datalist>
              </div>
              
              <div class="form-group">
                <label>Serial Number</label>
                <input 
                  type="text" 
                  id="indoor-serial"
                  value="${job.equipment.indoor.serial || ''}"
                  onchange="updateEquipmentField('indoor', 'serial', this.value)"
                  placeholder="Serial #">
              </div>
            </div>
          </div>
          ` : ''}
          
          <!-- Outdoor Unit -->
          ${selectedType !== 'furnace' && selectedType !== 'package_unit' ? `
          <div class="card-section">
            <div class="section-title">Outdoor Unit</div>
            <div class="form-grid form-grid-2">
              <div class="form-group">
                <label>Brand</label>
                <select id="outdoor-brand" onchange="updateEquipmentField('outdoor', 'brand', this.value); populateModels('outdoor')">
                  <option value="">Select brand...</option>
                  ${equipment.brands.map(brand => `
                    <option value="${brand}" ${job.equipment.outdoor.brand === brand ? 'selected' : ''}>
                      ${brand}
                    </option>
                  `).join('')}
                </select>
              </div>
              
              <div class="form-group">
                <label>Model Number</label>
                <input 
                  type="text" 
                  id="outdoor-model"
                  list="outdoor-models"
                  value="${job.equipment.outdoor.model || ''}"
                  onchange="updateEquipmentField('outdoor', 'model', this.value)"
                  placeholder="e.g., 24ACC3">
                <datalist id="outdoor-models"></datalist>
              </div>
              
              <div class="form-group">
                <label>Serial Number</label>
                <input 
                  type="text" 
                  id="outdoor-serial"
                  value="${job.equipment.outdoor.serial || ''}"
                  onchange="updateEquipmentField('outdoor', 'serial', this.value)"
                  placeholder="Serial #">
              </div>
            </div>
          </div>
          ` : ''}
          
          <!-- System Specs -->
          <div class="card-section">
            <div class="section-title">System Specifications</div>
            <div class="form-grid form-grid-3">
              
              ${equipment.specs.tonnage ? `
              <div class="form-group">
                <label>Tonnage</label>
                <select id="equipment-tonnage" onchange="updateEquipmentTonnage(this.value)">
                  <option value="">Select...</option>
                  ${equipment.specs.tonnage.map(ton => `
                    <option value="${ton}" ${job.equipment.tonnage === ton ? 'selected' : ''}>
                      ${ton} Ton
                    </option>
                  `).join('')}
                </select>
              </div>
              ` : ''}
              
              ${equipment.specs.btu ? `
              <div class="form-group">
                <label>BTU Rating</label>
                <select id="equipment-btu">
                  <option value="">Select...</option>
                  ${equipment.specs.btu.map(btu => `
                    <option value="${btu}">${btu} BTU</option>
                  `).join('')}
                </select>
              </div>
              ` : ''}
              
              ${equipment.specs.refrigerant ? `
              <div class="form-group">
                <label>Refrigerant Type</label>
                <select id="equipment-refrigerant" onchange="updateEquipmentField(null, 'refrigerant', this.value)">
                  ${equipment.specs.refrigerant.map(ref => `
                    <option value="${ref}" ${job.equipment.refrigerant === ref ? 'selected' : ''}>
                      ${ref}
                    </option>
                  `).join('')}
                </select>
              </div>
              ` : ''}
              
              <div class="form-group">
                <label>Filter Size</label>
                <input 
                  type="text" 
                  id="filter-size"
                  value="${job.equipment.filterSize || ''}"
                  onchange="updateEquipmentField(null, 'filterSize', this.value)"
                  placeholder="e.g., 16x25x1">
              </div>
              
              <div class="form-group">
                <label>Age (Years)</label>
                <input 
                  type="number" 
                  id="equipment-age"
                  value="${job.equipment.ageYears || ''}"
                  onchange="updateEquipmentField(null, 'ageYears', parseInt(this.value))"
                  placeholder="Age">
              </div>
              
              ${equipment.specs.seer ? `
              <div class="form-group">
                <label>SEER Rating</label>
                <select id="equipment-seer">
                  <option value="">Select...</option>
                  ${equipment.specs.seer.map(seer => `
                    <option value="${seer}">${seer} SEER</option>
                  `).join('')}
                </select>
              </div>
              ` : ''}
              
            </div>
          </div>
          
        </div>
      </div>
    `;
  }
  
  container.innerHTML = html;
  
  // Populate model suggestions if brand already selected
  if (selectedType) {
    populateModels('indoor');
    populateModels('outdoor');
  }
};

// Select equipment type
const selectEquipmentType = (typeKey) => {
  if (!AppState.currentJob) return;
  
  AppState.currentJob.equipment.type = typeKey;
  AppState.currentJob.updatedAt = new Date().toISOString();
  
  renderEquipmentSelector();
  saveToStorage();
  
  // Show measurements section
  renderMeasurementsSection();
  
  showToast('Equipment type selected');
};

// Update equipment field
const updateEquipmentField = (unit, field, value) => {
  if (!AppState.currentJob) return;
  
  if (unit) {
    // Update indoor/outdoor unit field
    AppState.currentJob.equipment[unit][field] = value;
  } else {
    // Update main equipment field
    AppState.currentJob.equipment[field] = value;
  }
  
  AppState.currentJob.updatedAt = new Date().toISOString();
  AppState.ui.unsavedChanges = true;
  
  saveToStorage();
};

// Update tonnage (special handler for calculations)
const updateEquipmentTonnage = (tonnage) => {
  if (!AppState.currentJob) return;
  
  AppState.currentJob.equipment.tonnage = tonnage;
  AppState.currentJob.updatedAt = new Date().toISOString();
  
  // Auto-calculate expected CFM
  const expectedCFM = parseFloat(tonnage) * 400;
  
  showToast(`Equipment: ${tonnage} ton (${expectedCFM} CFM nominal)`);
  
  saveToStorage();
};

// Populate model suggestions based on brand
const populateModels = (unit) => {
  const brandSelect = $(`${unit}-brand`);
  const modelDatalist = $(`${unit}-models`);
  
  if (!brandSelect || !modelDatalist) return;
  
  const brand = brandSelect.value;
  const equipmentType = AppState.currentJob?.equipment.type;
  
  if (!brand || !equipmentType) return;
  
  const equipment = equipmentDatabase[equipmentType];
  const models = equipment.commonModels[brand] || [];
  
  modelDatalist.innerHTML = models.map(model => 
    `<option value="${model}">${model}</option>`
  ).join('');
};
```

---

# **SECTION G: MEASUREMENTS HANDLER**

**PASTE THIS INTO `[INJECTION POINT G: MEASUREMENTS HANDLER]`**

```javascript
// ==================== MEASUREMENTS HANDLER ====================

// Measurement field definitions
const measurementFields = {
  cooling: {
    temperatures: [
      { id: 'outdoor-ambient', label: 'Outdoor Ambient', unit: '¬∞F', type: 'temp', min: 50, max: 120 },
      { id: 'return-air', label: 'Return Air', unit: '¬∞F', type: 'temp', min: 60, max: 90 },
      { id: 'supply-air', label: 'Supply Air', unit: '¬∞F', type: 'temp', min: 40, max: 70 },
      { id: 'suction-line', label: 'Suction Line Temp', unit: '¬∞F', type: 'temp', min: 30, max: 80 },
      { id: 'liquid-line', label: 'Liquid Line Temp', unit: '¬∞F', type: 'temp', min: 60, max: 120 }
    ],
    pressures: [
      { id: 'suction-pressure', label: 'Suction Pressure', unit: 'PSI', type: 'pressure', min: 50, max: 150 },
      { id: 'head-pressure', label: 'Head Pressure', unit: 'PSI', type: 'pressure', min: 150, max: 450 }
    ],
    electrical: [
      { id: 'voltage', label: 'Supply Voltage', unit: 'V', type: 'voltage', min: 200, max: 250 },
      { id: 'compressor-amps', label: 'Compressor Amps', unit: 'A', type: 'amperage', min: 0, max: 50 },
      { id: 'condenser-fan-amps', label: 'Cond. Fan Amps', unit: 'A', type: 'amperage', min: 0, max: 10 }
    ]
  },
  
  heating: {
    temperatures: [
      { id: 'return-air-heat', label: 'Return Air', unit: '¬∞F', type: 'temp', min: 60, max: 80 },
      { id: 'supply-air-heat', label: 'Supply Air', unit: '¬∞F', type: 'temp', min: 90, max: 160 }
    ],
    gas: [
      { id: 'manifold-pressure', label: 'Manifold Pressure', unit: 'in w.c.', type: 'pressure', min: 2, max: 12 },
      { id: 'supply-gas-pressure', label: 'Supply Gas Pressure', unit: 'in w.c.', type: 'pressure', min: 4, max: 14 }
    ],
    electrical: [
      { id: 'voltage-heat', label: 'Supply Voltage', unit: 'V', type: 'voltage', min: 105, max: 125 },
      { id: 'inducer-amps', label: 'Inducer Amps', unit: 'A', type: 'amperage', min: 0, max: 5 },
      { id: 'blower-amps', label: 'Blower Amps', unit: 'A', type: 'amperage', min: 0, max: 15 }
    ]
  }
};

// Render measurements section
const renderMeasurementsSection = () => {
  const container = $('measurements-container');
  if (!container) return;
  
  const issueType = AppState.currentJob?.issue.type;
  const equipmentType = AppState.currentJob?.equipment.type;
  
  if (!issueType || !equipmentType) {
    container.innerHTML = '';
    return;
  }
  
  // Determine which measurements to show
  let mode = 'cooling';
  if (issueType === 'no_heat' || equipmentType === 'furnace') {
    mode = 'heating';
  }
  
  const fields = measurementFields[mode];
  
  let html = `
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìè Diagnostic Measurements</div>
        <button class="btn btn-secondary btn-sm" onclick="clearAllMeasurements()">
          Clear All
        </button>
      </div>
      <div class="card-body">
  `;
  
  // Temperature section
  if (fields.temperatures) {
    html += `
      <div class="card-section">
        <div class="section-title">Temperatures</div>
        <div class="form-grid form-grid-3">
    `;
    
    fields.temperatures.forEach(field => {
      const lastValue = getLastMeasurementValue(field.id);
      
      html += `
        <div class="form-group">
          <label>${field.label}</label>
          <div style="position: relative;">
            <input 
              type="number" 
              step="0.1"
              id="${field.id}"
              value="${lastValue || ''}"
              onchange="handleMeasurementInput('${field.id}', this.value, '${field.unit}', '${field.label}', ${field.min}, ${field.max})"
              placeholder="Enter ${field.unit}">
            ${lastValue ? `<span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); font-size: 0.75rem;">${field.unit}</span>` : ''}
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  }
  
  // Pressure section
  if (fields.pressures) {
    html += `
      <div class="card-section">
        <div class="section-title">Pressures</div>
        <div class="form-grid form-grid-3">
    `;
    
    fields.pressures.forEach(field => {
      const lastValue = getLastMeasurementValue(field.id);
      
      html += `
        <div class="form-group">
          <label>${field.label}</label>
          <div style="position: relative;">
            <input 
              type="number" 
              step="0.1"
              id="${field.id}"
              value="${lastValue || ''}"
              onchange="handleMeasurementInput('${field.id}', this.value, '${field.unit}', '${field.label}', ${field.min}, ${field.max})"
              placeholder="Enter ${field.unit}">
            ${lastValue ? `<span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); font-size: 0.75rem;">${field.unit}</span>` : ''}
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  }
  
  // Gas section (heating only)
  if (fields.gas) {
    html += `
      <div class="card-section">
        <div class="section-title">Gas Measurements</div>
        <div class="form-grid form-grid-3">
    `;
    
    fields.gas.forEach(field => {
      const lastValue = getLastMeasurementValue(field.id);
      
      html += `
        <div class="form-group">
          <label>${field.label}</label>
          <div style="position: relative;">
            <input 
              type="number" 
              step="0.01"
              id="${field.id}"
              value="${lastValue || ''}"
              onchange="handleMeasurementInput('${field.id}', this.value, '${field.unit}', '${field.label}', ${field.min}, ${field.max})"
              placeholder="Enter ${field.unit}">
            ${lastValue ? `<span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); font-size: 0.75rem;">${field.unit}</span>` : ''}
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  }
  
  // Electrical section
  if (fields.electrical) {
    html += `
      <div class="card-section">
        <div class="section-title">Electrical</div>
        <div class="form-grid form-grid-3">
    `;
    
    fields.electrical.forEach(field => {
      const lastValue = getLastMeasurementValue(field.id);
      
      html += `
        <div class="form-group">
          <label>${field.label}</label>
          <div style="position: relative;">
            <input 
              type="number" 
              step="0.1"
              id="${field.id}"
              value="${lastValue || ''}"
              onchange="handleMeasurementInput('${field.id}', this.value, '${field.unit}', '${field.label}', ${field.min}, ${field.max})"
              placeholder="Enter ${field.unit}">
            ${lastValue ? `<span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); font-size: 0.75rem;">${field.unit}</span>` : ''}
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  }
  
  // Calculated values
  html += `
      <div class="card-section">
        <div class="section-title">Calculated Values</div>
        <div class="form-grid form-grid-3" id="calculated-values">
          <!-- Auto-populated by diagnostic engine -->
        </div>
      </div>
      
      </div>
    </div>
  `;
  
  container.innerHTML = html;
  
  // Run diagnostics if measurements exist
  if (AppState.currentJob?.measurements.length > 0) {
    runDiagnosticEngine();
  }
};

// Handle measurement input
const handleMeasurementInput = (fieldId, value, unit, label, min, max) => {
  if (!value || value === '') return;
  
  const numValue = parseFloat(value);
  
  // Validate range
  const input = $(fieldId);
  if (numValue < min || numValue > max) {
    input.classList.add('warning');
    showToast(`${label} seems unusual (expected ${min}-${max} ${unit})`, 'warning');
  } else {
    input.classList.remove('warning');
    input.classList.add('success');
  }
  
  // Add measurement to job
  addMeasurement('measurement', numValue, unit, label);
  
  // Run diagnostic engine
  runDiagnosticEngine();
  
  // Show suggestions
  renderSmartSuggestions();
};

// Get last measurement value for a field
const getLastMeasurementValue = (fieldId) => {
  if (!AppState.currentJob) return null;
  
  const measurements = AppState.currentJob.measurements
    .filter(m => m.field.toLowerCase().includes(fieldId.replace(/-/g, ' ')))
    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  
  return measurements[0]?.value || null;
};

// Clear all measurements
const clearAllMeasurements = () => {
  if (!AppState.currentJob) return;
  
  const confirmed = confirm('Clear all measurements?');
  if (!confirmed) return;
  
  AppState.currentJob.measurements = [];
  AppState.currentJob.updatedAt = new Date().toISOString();
  
  saveToStorage();
  renderMeasurementsSection();
  renderSmartSuggestions();
  
  showToast('Measurements cleared');
};

// Render quick measurements form (standalone page)
const renderQuickMeasurementsForm = () => {
  const container = $('quick-measurements-form');
  if (!container) return;
  
  let html = `
    <div class="card">
      <div class="card-header">
        <div class="card-title">Quick Entry</div>
      </div>
      <div class="card-body">
        <p class="text-muted mb-lg">Record measurements without creating a full job</p>
        
        <div class="form-group">
          <label>Measurement Type</label>
          <select id="quick-meas-type">
            <option value="">Select type...</option>
            <option value="temp">Temperature</option>
            <option value="pressure">Pressure</option>
            <option value="voltage">Voltage</option>
            <option value="amperage">Amperage</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Value</label>
          <input type="number" step="0.1" id="quick-meas-value" placeholder="Enter value">
        </div>
        
        <div class="form-group">
          <label>Notes (Optional)</label>
          <textarea id="quick-meas-notes" rows="2" placeholder="Additional context..."></textarea>
        </div>
        
        <button class="btn btn-primary" onclick="saveQuickMeasurement()">
          ‚úì Save Measurement
        </button>
      </div>
    </div>
  `;
  
  container.innerHTML = html;
};

// Save quick measurement
const saveQuickMeasurement = () => {
  const type = $('quick-meas-type')?.value;
  const value = $('quick-meas-value')?.value;
  const notes = $('quick-meas-notes')?.value;
  
  if (!type || !value) {
    showToast('Please fill in type and value', 'warning');
    return;
  }
  
  // Create standalone measurement (not tied to job)
  const measurement = {
    id: generateUUID(),
    timestamp: new Date().toISOString(),
    type,
    value: parseFloat(value),
    notes
  };
  
  // Save to a separate quick measurements array
  if (!AppState.quickMeasurements) {
    AppState.quickMeasurements = [];
  }
  
  AppState.quickMeasurements.push(measurement);
  
  // Clear form
  $('quick-meas-type').value = '';
  $('quick-meas-value').value = '';
  $('quick-meas-notes').value = '';
  
  showToast('Measurement saved');
  saveToStorage();
};
    
    
    // ==================== [INJECTION POINT F: EQUIPMENT DATABASE] ====================
    
    
    
    // ==================== [INJECTION POINT G: MEASUREMENTS HANDLER] ====================
    
    
    
    // ==================== [INJECTION POINT H: SMART SUGGESTIONS ENGINE] ====================
    // ==================== SMART SUGGESTIONS ENGINE ====================

// R-410A Pressure-Temperature Chart (simplified)
const R410A_PT = {
  118: 40, 125: 45, 133: 50, 140: 55, 148: 60,
  156: 65, 164: 70, 173: 75, 181: 80, 190: 85,
  200: 90, 210: 95, 220: 100, 230: 105, 241: 110,
  252: 115, 263: 120, 275: 125, 287: 130, 299: 135,
  312: 140, 325: 145, 338: 150
};

// Get saturation temperature from pressure
const getSaturationTemp = (pressure) => {
  const pressures = Object.keys(R410A_PT).map(Number);
  const closest = pressures.reduce((prev, curr) => 
    Math.abs(curr - pressure) < Math.abs(prev - pressure) ? curr : prev
  );
  return R410A_PT[closest];
};

// Diagnostic rules database
const diagnosticRules = {
  // Refrigerant Charge Issues
  undercharged: {
    conditions: (data) => {
      return data.superheat > 15 && data.subcool < 8;
    },
    diagnosis: 'System Undercharged - Refrigerant Leak Likely',
    confidence: 'high',
    evidence: ['High superheat', 'Low subcool', 'Reduced cooling capacity'],
    nextSteps: [
      'Perform leak check on evaporator coil',
      'Check all brazed joints and fittings',
      'Inspect line set connections',
      'Check service valve cores',
      'After leak repair, evacuate and recharge by weight'
    ],
    partsLikely: ['R-410A refrigerant', 'Filter drier', 'Leak seal'],
    safetyNotes: []
  },
  
  overcharged: {
    conditions: (data) => {
      return data.subcool > 15 && data.headPressure > 350;
    },
    diagnosis: 'System Overcharged',
    confidence: 'high',
    evidence: ['High subcool', 'Elevated head pressure', 'High amp draw'],
    nextSteps: [
      'Verify charge was not added incorrectly',
      'Check for non-condensables in system',
      'Recover excess refrigerant',
      'Recharge to manufacturer specifications'
    ],
    partsLikely: [],
    safetyNotes: ['High pressures - risk of compressor damage']
  },
  
  txv_restricted: {
    conditions: (data) => {
      return data.superheat > 20 && data.subcool >= 8 && data.subcool <= 12;
    },
    diagnosis: 'TXV Restricted or Sensing Bulb Issue',
    confidence: 'high',
    evidence: ['Very high superheat', 'Normal subcool', 'Low suction pressure'],
    nextSteps: [
      'Check TXV sensing bulb placement and contact',
      'Verify bulb insulation is intact',
      'Check for kinked liquid line before TXV',
      'Inspect filter drier for restriction',
      'Consider TXV replacement'
    ],
    partsLikely: ['TXV valve', 'Sensing bulb', 'Filter drier'],
    safetyNotes: []
  },
  
  // Airflow Issues
  low_airflow: {
    conditions: (data) => {
      return data.deltaT > 24 || data.staticPressure > 0.6;
    },
    diagnosis: 'Restricted Airflow - Low CFM',
    confidence: 'high',
    evidence: ['High temperature split', 'Elevated static pressure', 'Possible frozen coil'],
    nextSteps: [
      'CRITICAL: Replace air filter immediately',
      'Inspect evaporator coil for dirt/restrictions',
      'Check blower speed and motor',
      'Verify ductwork is properly sized',
      'Measure total external static pressure',
      'Check for closed/blocked supply vents'
    ],
    partsLikely: ['Air filter', 'Blower motor', 'Capacitor'],
    safetyNotes: ['Risk of frozen evaporator coil']
  },
  
  excessive_airflow: {
    conditions: (data) => {
      return data.deltaT < 14;
    },
    diagnosis: 'Excessive Airflow or Low Refrigerant',
    confidence: 'medium',
    evidence: ['Low temperature split', 'Reduced dehumidification'],
    nextSteps: [
      'Check blower speed setting',
      'Verify ductwork design CFM',
      'Check for refrigerant undercharge',
      'Measure actual CFM at registers'
    ],
    partsLikely: [],
    safetyNotes: []
  },
  
  // Condenser Issues
  dirty_condenser: {
    conditions: (data) => {
      return data.headPressure > 350 && data.outdoorAmbient < 95;
    },
    diagnosis: 'Restricted Condenser Airflow - Dirty Coil',
    confidence: 'high',
    evidence: ['High head pressure', 'Normal outdoor temp', 'High amp draw'],
    nextSteps: [
      'Clean condenser coil thoroughly',
      'Check condenser fan operation',
      'Verify condenser fan motor amps',
      'Inspect for debris or obstructions',
      'Check fin condition'
    ],
    partsLikely: ['Coil cleaner', 'Condenser fan motor', 'Fan blade'],
    safetyNotes: ['High head pressure - monitor compressor']
  },
  
  // Electrical Issues
  low_voltage: {
    conditions: (data) => {
      return data.voltage < 207 || data.voltage > 253;
    },
    diagnosis: 'Supply Voltage Out of Range',
    confidence: 'high',
    evidence: ['Voltage outside ¬±10% of rated', 'Possible compressor damage'],
    nextSteps: [
      'Check voltage at disconnect',
      'Inspect wire connections for looseness',
      'Contact utility company if persistently low',
      'Consider voltage stabilizer'
    ],
    partsLikely: ['Voltage regulator/stabilizer'],
    safetyNotes: ['Low voltage can damage compressor']
  },
  
  high_amp_draw: {
    conditions: (data) => {
      return data.rla && data.compressorAmps > (data.rla * 1.1);
    },
    diagnosis: 'Compressor Drawing Excessive Current',
    confidence: 'high',
    evidence: ['Amps exceed RLA by >10%', 'Possible failing compressor'],
    nextSteps: [
      'Check supply voltage (low voltage increases amps)',
      'Verify capacitor is within spec',
      'Check for refrigerant overcharge',
      'Inspect for restricted airflow',
      'Monitor compressor temperature'
    ],
    partsLikely: ['Run capacitor', 'Compressor'],
    safetyNotes: ['High amps - compressor may fail soon']
  },
  
  // Heating Issues
  low_temp_rise: {
    conditions: (data) => {
      return data.tempRise && data.tempRise < 35;
    },
    diagnosis: 'Low Temperature Rise - Insufficient Heating',
    confidence: 'high',
    evidence: ['Temp rise below 35¬∞F', 'Reduced heating output'],
    nextSteps: [
      'Check gas manifold pressure (3.3-3.8" w.c.)',
      'Inspect burners for proper flame pattern',
      'Verify all burners are igniting',
      'Check for excessive airflow (blower too fast)',
      'Inspect gas valve operation'
    ],
    partsLikely: ['Gas valve', 'Orifices', 'Igniter'],
    safetyNotes: []
  },
  
  high_temp_rise: {
    conditions: (data) => {
      return data.tempRise && data.tempRise > 70;
    },
    diagnosis: 'High Temperature Rise - Airflow Restriction',
    confidence: 'high',
    evidence: ['Temp rise above 70¬∞F', 'Risk of heat exchanger damage'],
    nextSteps: [
      'CRITICAL: Check airflow restriction immediately',
      'Replace air filter',
      'Verify blower speed is correct',
      'Inspect heat exchanger for restrictions',
      'Check limit switches for cycling'
    ],
    partsLikely: ['Air filter', 'Blower motor', 'Limit switch'],
    safetyNotes: ['CRITICAL: High temp rise can crack heat exchanger']
  }
};

// Run diagnostic engine
const runDiagnosticEngine = () => {
  if (!AppState.currentJob) return;
  
  const measurements = AppState.currentJob.measurements;
  if (measurements.length === 0) return;
  
  // Extract key measurements
  const data = {
    outdoorAmbient: getLastMeasurementValue('outdoor-ambient'),
    returnAir: getLastMeasurementValue('return-air'),
    supplyAir: getLastMeasurementValue('supply-air'),
    suctionPressure: getLastMeasurementValue('suction-pressure'),
    suctionTemp: getLastMeasurementValue('suction-line'),
    headPressure: getLastMeasurementValue('head-pressure'),
    liquidTemp: getLastMeasurementValue('liquid-line'),
    voltage: getLastMeasurementValue('voltage'),
    compressorAmps: getLastMeasurementValue('compressor-amps'),
    staticPressure: getLastMeasurementValue('static-pressure'),
    rla: AppState.currentJob.equipment.rla,
    tempRise: null,
    deltaT: null,
    superheat: null,
    subcool: null
  };
  
  // Calculate derived values
  if (data.returnAir && data.supplyAir) {
    data.deltaT = data.returnAir - data.supplyAir;
  }
  
  if (data.suctionPressure && data.suctionTemp) {
    const satTemp = getSaturationTemp(data.suctionPressure);
    data.superheat = data.suctionTemp - satTemp;
  }
  
  if (data.headPressure && data.liquidTemp) {
    const satTemp = getSaturationTemp(data.headPressure);
    data.subcool = satTemp - data.liquidTemp;
  }
  
  // For heating
  const returnHeat = getLastMeasurementValue('return-air-heat');
  const supplyHeat = getLastMeasurementValue('supply-air-heat');
  if (returnHeat && supplyHeat) {
    data.tempRise = supplyHeat - returnHeat;
  }
  
  // Update calculated values display
  updateCalculatedValues(data);
  
  // Run diagnostic rules
  const suggestions = [];
  
  Object.keys(diagnosticRules).forEach(ruleKey => {
    const rule = diagnosticRules[ruleKey];
    
    if (rule.conditions(data)) {
      suggestions.push({
        id: ruleKey,
        ...rule,
        timestamp: new Date().toISOString()
      });
    }
  });
  
  // Store suggestions in job
  AppState.currentJob.suggestions = suggestions;
  
  // Render suggestions
  renderSmartSuggestions();
};

// Update calculated values display
const updateCalculatedValues = (data) => {
  const container = $('calculated-values');
  if (!container) return;
  
  let html = '';
  
  // Delta-T
  if (data.deltaT !== null) {
    const deltaClass = data.deltaT >= 16 && data.deltaT <= 22 ? 'success' : 'warning';
    html += `
      <div class="form-group">
        <label>Delta-T (Return - Supply)</label>
        <input type="text" class="${deltaClass}" readonly value="${data.deltaT.toFixed(1)}¬∞F">
      </div>
    `;
  }
  
  // Superheat
  if (data.superheat !== null) {
    const shClass = data.superheat >= 8 && data.superheat <= 15 ? 'success' : 'warning';
    html += `
      <div class="form-group">
        <label>Superheat</label>
        <input type="text" class="${shClass}" readonly value="${data.superheat.toFixed(1)}¬∞F">
      </div>
    `;
  }
  
  // Subcool
  if (data.subcool !== null) {
    const scClass = data.subcool >= 8 && data.subcool <= 12 ? 'success' : 'warning';
    html += `
      <div class="form-group">
        <label>Subcool</label>
        <input type="text" class="${scClass}" readonly value="${data.subcool.toFixed(1)}¬∞F">
      </div>
    `;
  }
  
  // Temperature Rise (heating)
  if (data.tempRise !== null) {
    const trClass = data.tempRise >= 35 && data.tempRise <= 65 ? 'success' : 'warning';
    html += `
      <div class="form-group">
        <label>Temperature Rise</label>
        <input type="text" class="${trClass}" readonly value="${data.tempRise.toFixed(1)}¬∞F">
      </div>
    `;
  }
  
  if (html === '') {
    html = '<p class="text-muted">Enter measurements to see calculated values</p>';
  }
  
  container.innerHTML = html;
};

// Render smart suggestions
const renderSmartSuggestions = () => {
  const container = $('suggestions-container');
  if (!container) return;
  
  const suggestions = AppState.currentJob?.suggestions || [];
  
  if (suggestions.length === 0) {
    container.innerHTML = '';
    return;
  }
  
  let html = `
    <div class="card" style="border: 2px solid var(--cyan); background: rgba(0, 217, 255, 0.05);">
      <div class="card-header" style="background: rgba(0, 217, 255, 0.1);">
        <div class="card-title">üí° Smart Diagnostic Suggestions</div>
      </div>
      <div class="card-body">
  `;
  
  suggestions.forEach(suggestion => {
    const confidenceColor = suggestion.confidence === 'high' ? 'var(--success)' : 'var(--warning)';
    
    html += `
      <div style="background: var(--bg-elevated); border: 1px solid var(--glass-border); border-radius: var(--radius-lg); padding: var(--space-xl); margin-bottom: var(--space-lg);">
        
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-md);">
          <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--text-primary); margin: 0;">
            ${suggestion.diagnosis}
          </h3>
          <span style="padding: 4px 12px; background: ${confidenceColor}; color: white; border-radius: 20px; font-size: 0.6875rem; font-weight: 700; text-transform: uppercase;">
            ${suggestion.confidence} confidence
          </span>
        </div>
        
        ${suggestion.safetyNotes.length > 0 ? `
          <div style="background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--danger); padding: var(--space-md); margin-bottom: var(--space-md); border-radius: var(--radius);">
            <strong style="color: var(--danger);">‚ö†Ô∏è Safety Alert:</strong>
            <ul style="margin: var(--space-sm) 0 0 var(--space-lg); color: var(--text-secondary);">
              ${suggestion.safetyNotes.map(note => `<li>${note}</li>`).join('')}
            </ul>
          </div>
        ` : ''}
        
        <div style="margin-bottom: var(--space-md);">
          <strong style="color: var(--cyan); font-size: 0.875rem;">Evidence:</strong>
          <ul style="margin: var(--space-sm) 0 0 var(--space-lg); color: var(--text-secondary); font-size: 0.875rem;">
            ${suggestion.evidence.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        
        <div style="margin-bottom: var(--space-md);">
          <strong style="color: var(--cyan); font-size: 0.875rem;">Next Steps:</strong>
          <ol style="margin: var(--space-sm) 0 0 var(--space-lg); color: var(--text-secondary); font-size: 0.875rem;">
            ${suggestion.nextSteps.map(step => `<li style="margin: var(--space-sm) 0;">${step}</li>`).join('')}
          </ol>
        </div>
        
        ${suggestion.partsLikely.length > 0 ? `
          <div>
            <strong style="color: var(--cyan); font-size: 0.875rem;">Parts Likely Needed:</strong>
            <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap; margin-top: var(--space-sm);">
              ${suggestion.partsLikely.map(part => `
                <span style="background: var(--bg-tertiary); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; color: var(--text-secondary);">
                  ${part}
                </span>
              `).join('')}
            </div>
          </div>
        ` : ''}
        
      </div>
    `;
  });
  
  html += `
      </div>
    </div>
  `;
  
  container.innerHTML = html;
};
    
    
    // ==================== [INJECTION POINT I: PHOTO MANAGEMENT] ====================
    
    
    
    // ==================== [INJECTION POINT J: MATERIAL PACKAGES] ====================
    
    
    
    // ==================== [INJECTION POINT K: REPORT GENERATION] ====================
    
    
    
    // ==================== [INJECTION POINT L: DATA EXPORT/IMPORT] ====================
    
    
    
    // ==================== [INJECTION POINT M: APP INITIALIZATION] ====================
    
    
    
  </script>
</body>
</html>